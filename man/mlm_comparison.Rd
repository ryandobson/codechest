% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mlm_comparison.R
\name{mlm_comparison}
\alias{mlm_comparison}
\title{Stepwise Random-Effects Structure Comparison for Multilevel Models}
\usage{
mlm_comparison(
  data,
  dv,
  fixed_effects,
  random_effects,
  group,
  model_env = NULL,
  history = NULL,
  counter = 1,
  allow_drop_intercept = FALSE,
  verbose = FALSE
)
}
\arguments{
\item{data}{A data frame containing all model variables.}

\item{dv}{Character string. The dependent variable name.}

\item{fixed_effects}{Character vector of fixed-effect predictors.}

\item{random_effects}{Character vector specifying random effects
(e.g., \code{c("1", "slope1", "slope2")}).
Must include \code{"1"} to specify a random intercept.}

\item{group}{Character string naming the grouping factor (e.g., \code{"id"}).}

\item{model_env}{Optional environment in which to evaluate the model
formula. Useful when constructing formulas dynamically. Defaults to \code{NULL}.}

\item{history}{Optional list created by \code{\link[=init_history]{init_history()}} that stores the
stepwise model comparison record. If \code{NULL}, a new history object is
initialized automatically.}

\item{counter}{Integer index of the current step in the recursive process.
Defaults to \code{1}. Generally used internally.}

\item{allow_drop_intercept}{Logical. If \code{TRUE}, allows testing whether
the random intercept can be dropped (i.e., compare random-intercept-only
vs fixed-effects-only model). Defaults to \code{FALSE}.}

\item{verbose}{Logical. If \code{TRUE}, prints progress messages describing
each comparison step and decision to the console. Defaults to \code{FALSE}.}
}
\value{
A \code{history} list containing all model comparison steps appended by
\code{\link[=append_step_mlm_comparison]{append_step_mlm_comparison()}}.
The returned object includes metadata attributes:
\describe{
\item{\code{attr(., "last_step")}}{Numeric index of the final step.}
\item{\code{attr(., "last_action")}}{String indicating the type of last action.}
\item{\code{attr(., "timestamp")}}{POSIXct time when the final step was logged.}
}
Each entry of \code{history} contains:
\itemize{
\item \code{model1}, \code{model2}: compared model objects (typically from \code{\link[lmerTest:lmer]{lmerTest::lmer()}}).
\item \code{mod_comp}: ANOVA comparison results.
\item \code{dropped}, \code{kept}: random-effect terms removed or retained.
\item \code{next_action}: string describing next comparison step.
}
}
\description{
Performs a structured, semi-automated model comparison procedure for
multilevel models (typically fit via \code{\link[lmerTest:lmer]{lmerTest::lmer()}}) to determine
the optimal random-effects structure.
The function iteratively compares nested models—dropping random slopes,
testing covariance inclusion, or comparing random-intercept-only
versus fixed-effects-only models—while logging all decisions in a
reproducible \code{history} object.
}
\details{
This function is designed to automate common multilevel model comparison
workflows where the researcher sequentially simplifies or expands the random
effects structure based on likelihood ratio tests.

It supports the following step types:
\itemize{
\item \strong{initial_model:} fits the full random-effects structure.
\item \strong{drop_smallest:} drops the least-variant random slope term.
\item \strong{add_covariances:} tests whether allowing random-effect
covariances improves model fit.
\item \strong{ri_versus_fixed:} compares random-intercept-only vs.
fixed-effects-only models.
\item \strong{final_model:} logs the final retained model.
}

Each step is recorded via \code{\link[=append_step_mlm_comparison]{append_step_mlm_comparison()}}, producing
a structured \code{history} list with all comparisons, p-values, retained
models, and metadata.

The function is recursive: when \code{p > .20} and further reduction is possible,
it automatically calls itself with the updated random-effects specification.
}
\examples{
\dontrun{
library(lme4)
data(sleepstudy)

# Define random and fixed effects
dv <- "Reaction"
fixed_effects <- "Days"
random_effects <- c("1", "Days")
group <- "Subject"

# Run stepwise model comparison
hist_obj <- mlm_comparison(
  data = sleepstudy,
  dv = dv,
  fixed_effects = fixed_effects,
  random_effects = random_effects,
  group = group,
  verbose = TRUE
)

# Review summary of retained steps
str(hist_obj, max.level = 1)
}

}
\seealso{
\code{\link[=append_step_mlm_comparison]{append_step_mlm_comparison()}}, \code{\link[=anova]{anova()}}, \code{\link[lmerTest:lmer]{lmerTest::lmer()}}
}
